<head>
  <title>StripeSheet</title>
</head>

<body>
  {{>loginButtons}}
  {{#if currentUser}}
    {{>spreadsheet}}
    
    {{#if isAdmin}}
      {{>invite_manager}}
    {{/if}}
  {{else}}
    {{>create_account}}
  {{/if}}
    
</body>

<template name="spreadsheet">
  <table>
    <thead>
      {{#each field in fields}}
        <td>{{field.name}}</td>
      {{/each}}
    </thead>
    <tbody>
      {{#each doc in documents}}
        {{>document document=doc}}
      {{/each}}
    </tbody>
  </table>
  {{>new_document}}
</template>


<template name="document">
  <tr>
    {{#each field in fields}}
      <td>{{>document_field field=field document=document}}</td>
    {{/each}}
  </tr>
</template>

<template name="document_field">
  {{value}}
</template>

<template name="new_document">
  <form>
    {{#each field in fields}}
      {{>input_for_field field=field}}
    {{/each}}
  <input type="submit">
  </form>
</template>

<template name="input_for_field">
  <label>{{field.name}}<input type={{getInputType field}} value={{field.default}} data-field={{field.dbField}}></label>
</template>

<template name="cell">
  {{value}}
</template>

<template name="create_account">
  <form>
    <label>Email<input type="email" data-field="email"></label>
    <label>Password<input type="password" data-field="password"></label>
    <label>Token<input type="text" data-field="token"></label>
    <input type="submit">
  </form>
</template>

<template name="invite_manager">
  <h3>Token manager</h3>
  {{#each invites}}
    <div>{{date_created}} {{token}} <button data-action="invite_remove">Delete</button></div>
  {{/each}}
  <button data-action="invite_create">New token</button>
</template>